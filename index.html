<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Snake - New skins</title>
    <style>
        :root { --p: #0f0; --bg: #050505; }
        body { background: var(--bg); color: var(--p); font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; margin: 0; overflow: hidden; }
        #game-container { position: relative; margin-top: 20px; box-shadow: 0 0 20px rgba(0,255,0,0.2); }
        canvas { border: 2px solid var(--p); display: block; }
        #ui { position: absolute; top: 0; left: 0; width: 400px; height: 400px; pointer-events: none; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.8); }
        .btn { pointer-events: auto; background: none; border: 1px solid var(--p); color: var(--p); padding: 10px 20px; cursor: pointer; font-family: inherit; margin: 5px; transition: 0.2s; }
        .btn:hover { background: var(--p); color: #000; }
        #leaderboard-container { margin-top: 15px; width: 200px; font-size: 12px; border-top: 1px solid #333; padding-top: 10px; }
        .leaderboard-row { display: flex; justify-content: space-between; margin: 2px 0; }
        #score-board { position: absolute; top: -30px; left: 0; width: 100%; display: flex; justify-content: space-between; font-size: 18px; }
        .skin-select { pointer-events: auto; margin-top: 10px; display: flex; gap: 5px; }
        .skin-btn { width: 30px; height: 30px; border: 1px solid #555; cursor: pointer; }
        .skin-btn.active { border-color: #fff; transform: scale(1.1); }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="score-board">
            <span>Score: <span id="score">0</span></span>
            <span>Best: <span id="best">0</span></span>
        </div>
        <canvas id="game" width="400" height="400"></canvas>
        
        <div id="ui">
            <h1 id="menu-title">NEON SNAKE</h1>
            <button class="btn" id="start-btn">START GAME</button>
            
            <div class="skin-select" id="skin-menu">
                <div class="skin-btn active" style="background:#0f0" data-skin="classic"></div>
                <div class="skin-btn" style="background:linear-gradient(45deg, #ff00ff, #00ffff)" data-skin="cyber"></div>
                <div class="skin-btn" style="background:#ff9500" data-skin="gold"></div>
                <div class="skin-btn" style="background:#ff3b30" data-skin="lava"></div>
            </div>

            <div id="leaderboard-container">
                <div style="text-align:center">Loading Global Scores...</div>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/** * FILL THESE TWO LINES WITH YOUR SUPABASE INFO:
 */
const SB_URL = 'PASTE_YOUR_URL_HERE';
const SB_KEY = 'PASTE_YOUR_ANON_PUBLIC_KEY_HERE';

// Connect to Database
const supabase = window.supabase ? window.supabase.createClient(SB_URL, SB_KEY) : null;

// Audio Setup
const audio = {
    ctx: new (window.AudioContext || window.webkitAudioContext)(),
    play(freq, type, dur) {
        const osc = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        g.gain.setValueAtTime(0.1, this.ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, this.ctx.currentTime + dur);
        osc.connect(g); g.connect(this.ctx.destination);
        osc.start(); osc.stop(this.ctx.currentTime + dur);
    }
};

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('start-btn');
const ui = document.getElementById('ui');
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');

let state = {
    score: 0,
    best: localStorage.getItem('snakeBest') || 0,
    active: false,
    skin: 'classic'
};
bestEl.textContent = state.best;

const snake = {
    x: 10, y: 10, dx: 0, dy: 0, cells: [], length: 4,
    reset() { this.x = 10; this.y = 10; this.cells = []; this.length = 4; this.dx = 1; this.dy = 0; }
};
const food = { x: 15, y: 15 };

// Leaderboard Logic
async function loadLeaderboard() {
    if(!supabase) return;
    const { data, error } = await supabase.from('Leaderboard').select('username, score').order('score', { ascending: false }).limit(5);
    if(error) return;
    const container = document.getElementById('leaderboard-container');
    container.innerHTML = '<div style="padding:5px; font-size:10px; color:#888; text-align:center">GLOBAL TOP 5</div>';
    data.forEach(row => {
        container.innerHTML += `<div class="leaderboard-row"><span>${row.username}</span><b>${row.score}</b></div>`;
    });
}

async function submitScore(score) {
    if(!supabase || score === 0) return;
    const name = prompt("New High Score! Enter your name:") || "Player";
    await supabase.from('Leaderboard').insert([{ username: name, score: score }]);
    loadLeaderboard();
}

// Skins Logic
document.querySelectorAll('.skin-btn').forEach(btn => {
    btn.onclick = () => {
        document.querySelectorAll('.skin-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.skin = btn.dataset.skin;
        audio.play(400, 'square', 0.1);
    };
});

function loop() {
    if(!state.active) return;
    setTimeout(() => requestAnimationFrame(loop), 100);
    
    ctx.clearRect(0,0,canvas.width,canvas.height);
    snake.x += snake.dx; snake.y += snake.dy;

    if(snake.x < 0) snake.x = 19; else if(snake.x > 19) snake.x = 0;
    if(snake.y < 0) snake.y = 19; else if(snake.y > 19) snake.y = 0;

    snake.cells.unshift({x: snake.x, y: snake.y});
    if(snake.cells.length > snake.length) snake.cells.pop();

    // Draw Food
    ctx.fillStyle = '#ff3b30';
    ctx.shadowBlur = 10; ctx.shadowColor = '#ff3b30';
    ctx.fillRect(food.x*20, food.y*20, 18, 18);

    // Draw Snake
    snake.cells.forEach((cell, index) => {
        if(state.skin === 'classic') ctx.fillStyle = '#0f0';
        if(state.skin === 'cyber') ctx.fillStyle = `hsl(${(index * 20) + (Date.now()/10)}, 100%, 50%)`;
        if(state.skin === 'gold') ctx.fillStyle = '#ffd700';
        if(state.skin === 'lava') ctx.fillStyle = index === 0 ? '#fff' : '#ff4500';
        
        ctx.shadowBlur = 15; ctx.shadowColor = ctx.fillStyle;
        ctx.fillRect(cell.x*20, cell.y*20, 18, 18);

        if(cell.x === food.x && cell.y === food.y) {
            snake.length++;
            state.score += 10;
            scoreEl.textContent = state.score;
            food.x = Math.floor(Math.random()*20);
            food.y = Math.floor(Math.random()*20);
            audio.play(600, 'sine', 0.1);
        }

        for(let i = index + 1; i < snake.cells.length; i++) {
            if(cell.x === snake.cells[i].x && cell.y === snake.cells[i].y) {
                gameOver();
            }
        }
    });
}

function gameOver() {
    state.active = false;
    audio.play(150, 'sawtooth', 0.5);
    ui.style.display = 'flex';
    document.getElementById('menu-title').textContent = "GAME OVER";
    if(state.score > state.best) {
        state.best = state.score;
        localStorage.setItem('snakeBest', state.best);
        bestEl.textContent = state.best;
        submitScore(state.score);
    }
}

startBtn.onclick = () => {
    state.score = 0;
    scoreEl.textContent = "0";
    state.active = true;
    ui.style.display = 'none';
    snake.reset();
    audio.play(800, 'sine', 0.2);
    loop();
};

document.addEventListener('keydown', e => {
    if(e.key === 'ArrowUp' && snake.dy === 0) { snake.dx = 0; snake.dy = -1; }
    if(e.key === 'ArrowDown' && snake.dy === 0) { snake.dx = 0; snake.dy = 1; }
    if(e.key === 'ArrowLeft' && snake.dx === 0) { snake.dx = -1; snake.dy = 0; }
    if(e.key === 'ArrowRight' && snake.dx === 0) { snake.dx = 1; snake.dy = 0; }
});

loadLeaderboard();
</script>
</body>
</html>
